{% extends 'auction/base.html' %}

{% block title_block %} 
    {{ lot.title }}
{% endblock %}

{% block content %}
    <div class="post">
        <div class="message">{{ mess }}</div>
        {% if lot.published_date %}
            <div class="date">
                {{ lot.published_date}} by {{lot.author}}
            </div>
        {% endif %}
        <div class="h1">{{ lot.title }}
            {% if lot.is_open == False %}
                {% for item in win %} 
                    [Sold] Winner: {{item.winner}} 
                {% endfor %}
            {% endif%}
            {% if ed %}
                {% if lot.is_open %}
                    <a class="btn btn-default" href="{% url 'lot_edit' pk=lot.pk %}"><span class="glyphicon glyphicon-pencil"></span></a>
                {% endif %}
                <a class="btn btn-default" href="{% url 'lot_remove' pk=lot.pk %}"><span class="glyphicon glyphicon-remove"></span></a>
            {% endif %}
        </div>
        <div class="description">{{ lot.text|linebreaksbr }}</div>
        <div class="cur_price">
            Current price: {{lot.starting_price}} Tokens
        </div>
        <div class="cur_price">
            End date: {{ lot.end_date}}
        </div>
        <hr>
        {% if ed and lot.is_open%} 
            <form id="sold" class="post-form save" method="post" action"={% url 'lot_detail' pk=lot.pk %}">
                {% csrf_token %}
                <input type="submit" class="btn btn-default" name="submit" value="Sold lot"/>
            </form>
        {% endif %}
        {% if lot.end_date and lot.end_date > date_now  and lot.is_open %}
            <div class="h2">Status: Lot open</div>
            {% if ed %}
                <div>Просмотров: {{lot.views}}</div>
            {% else %}
                <div class="form">
                    {% csrf_token %}
                    <div id="user_views">
                        <button class="btn btn-default" id="get_views" data-ad-id="{{ lot.id }}" value="Get view">Get author views</button>
                    </div>
                </div>
                <script src="/static/js/get_views.js"></script>
                <hr>
                <form id="form" class="post-form" method="post" action"={% url 'lot_detail' pk=lot.pk %}">
                    {% csrf_token %}
                    <div class="form-group">
                        {{ form.as_p }}
                    </div>
                    <input type="submit" class="btn btn-default" name="submit" value="Rate" />
                </form>
            {% endif %}  
        {% else %}
            {% if lot.is_open == False %}
                <div class="h2">Status: The lot is closed</div>
            {% else %}
                <div class="h2">Status: Time is over, wait for confirmation</div>
            {% endif %}
        {% endif %}

        <hr>
        {% if backers_list %}
        <table class="table table-hover">
            <thead>
                <tr>
                    <th width="50%">Partisipant</th>
                    <th>Rate</th>
                </tr>
            </thead>
            <tbody>
                {% for backer in backers_list %}
                    <tr>
                        <td>{{backer.participant}}</td>
                        <td>{{backer.rate}}</td>
                    </tr>
                {% endfor %}
            </tbody>
        <table>
        {% else %}
            <div class="h4">There are no participant<div>
        {% endif %}
    </div>
    <hr>
{% endblock %}